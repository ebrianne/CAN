%!TeX spellcheck = en-US
%!TEX root = CAN.tex
\documentclass{JINST}

\usepackage{graphicx}
\usepackage[position=b]{subcaption}
\captionsetup[subfigure]{width=0.9\textwidth}

\usepackage{booktabs} % For professional looking tables
\usepackage{multirow}

\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[T1]{fontenc}
\usepackage{siunitx} % use this package module for SI units

\usepackage{lineno}
\linenumbers

\usepackage{xspace}
\newcommand\geant{\textsc{Geant\,4}\xspace}
\newcommand\mokka{\textsc{Mokka}\xspace}
\newcommand\ddhep{\textsc{DD4hep}\xspace}
\newcommand\ilcsoft{\textsc{ILCSoft}\xspace}
\newcommand\cpp{\textsc{C++}\xspace}
\newcommand\marlin{\textsc{Marlin}\xspace}
\newcommand\lcio{\textsc{LCIO}\xspace}
\newcommand\qt{\textsc{Qt}\xspace}

\usepackage{epstopdf}

\preprint{CALICE-CAN-2018-061 \\v3\\ \today}

\renewcommand{\thefootnote}{\fnsymbol{footnote}}
\renewcommand{\floatpagefraction}{0.95}

\title{Timing of hadron showers in the CALICE Analog Hadronic Calorimeter prototype using steel absorber}

\author{The CALICE Collaboration\thanks{Corresponding author: Eldwan Brianne (eldwan.brianne@desy.de)) } \\
\vspace{10 mm}

{\rm \bf \normalsize This note contains preliminary CALICE results, and is for the use of members of the CALICE Collaboration and others to whom permission has been given.}
}

\abstract{This note presents results obtained with the CALICE Analog Hadronic Calorimeter prototype with steel absorber at the SPS CERN testbeam campaign in July 2015. The analysis presents the timing calibration and includes timing distributions for muon, electron and pion beams. The results are compared to several \geant version 10.1 physics lists.}

\begin{document}

\section{Introduction}

Experiments at future lepton colliders require unprecedented jet energy resolution of 3-4\% up to 250 GeV jet energies. The Particle Flow concept (PFAs) \cite{Thomson:2009rp} aims to achieve such resolutions by combining measurements of the tracker and calorimeters. This requires exceptional granularity for the calorimeters. The CALICE Collaboration develops, builds and tests such calorimeters to fulfil the requirements imposed by PFAs. One calorimeter concept is the Analog Hadronic Calorimeter (AHCAL) that consists of scintillator tiles of $3\times3$ cm$^2$ readout by Silicon Photomultipliers (SiPMs). Several prototypes with different absorbers, granularity and readout have been tested \cite{Sefkow:316196, Krueger:205287}.

Apart from energy measurement, the aspect of precise timing measurement is being investigated. Timing measurements in a calorimeter can be used to reject out of time pile-up events. In addition, the impact of background events on physics measurements such as $\gamma\gamma \rightarrow$ hadrons background, could be mitigated by using timing information of the calorimeters and trackers \cite{Barklow:2016tza}. Moreover, time information could be used to improve the energy reconstruction of hadronic showers by distinguishing the electromagnetic and hadronic components of the shower.\cite{Benaglia2016}.

The CALICE Analog Hadronic Calorimeter (AHCAL) prototype with steel absorber has been installed in the SPS CERN facilities in July 2015. This prototype was partially instrumented and was comprised of several versions of active readout (SiPM, scintillator material, tile wrapping). The performance of this prototype is not expected to reach the final performance of the engineering prototype. Furthermore, this prototype was operated at a lower clock speed than the design in order to enhance the data taking efficiency at a testbeam with a continuous beam. This limits the timing resolution. For bunched beams at a lepton collider, a 20 times faster clock is foreseen. This note presents the time calibration procedure of the AHCAL and the results obtained in muon, electron and pion beams in an energy range from 10 GeV to 90 GeV, as indicated in Table \ref{table:dataruns} in the appendix. This analysis is the first of its kind to such a system level and enters new territories for high granular calorimeters.

\section{Testbeam Setup}

The testbeam setup at CERN in July 2015, at the SPS beamline H2, is shown in figure \ref{fig:TestbeamScketch}.

\begin{figure}[htbp!]
  \centering
  \includegraphics[width=0.7\linewidth]{fig/TestbeamSetup.eps}
  \caption{Sketch view of the beamline setup at the CERN SPS H2 beamline in July 2015. The size of the beamline elements is not to scale.} \label{fig:TestbeamScketch}
\end{figure}

The AHCAL prototype absorber stack is composed of 48 steel plates in which 14 active modules were installed. The two first modules consist of single ECAL Base Units (EBUs) with $4 \times 36$ cells of $4.5 \times 0.5$ cm$^2$ size. The ECAL cells of both modules are oriented parallel to the x-axis. The next eight modules consist of single HCAL Base Units (HBUs) with $12 \times 12$ cells of $3 \times 3$ cm$^2$ size . The absorber plates have a thickness of 1.7 cm, such that the first 10 modules correspond to a depth of around 10 X$_0$ ($\sim$ 1 $\lambda_{\pi}$). These modules were mainly used as a shower start finder. The last four modules consist of 2 by 2 HBUs providing information about the development of pion showers at different depths. In total, the prototype has 3744 channels. Table \ref{table:AHCALlayer_structure} provides an overview of the AHCAL layer structure. It uses SiPM technology coupled to scintillator tiles readout by an application specific integrated chip, the SPIROC2b \cite{5401891}. A diverse variety of SiPMs and tile designs were used in this testbeam, details of the SiPM characteristics can be seen in Table \ref{table:sipm_list}. The AHCAL detector was placed on a movable stage in order to be able to scan the detector with muons for calibration runs.

\begin{table}[htb!]
  \centering
  \caption{Layer structure of the AHCAL in July 2015.}
  \label{table:AHCALlayer_structure}
  \begin{tabular}{@{}lllll@{}}
    \toprule
    Absorber Slot \# & Layer \# & Abs. thickness before layer [X$_0$/$\lambda_{\pi}$] & Layer size [cm$^{2}$] & $N_{chn}$\\
    \midrule
    1-2 & 1-2 & $\sim$1/0.1 & $18\times18$ & 288\\
    3-10 & 3-10 & $\sim$1/0.1 & $36\times36$ & 1152\\
    11 & 11 & $\sim$1/0.1 & $72\times72$ & 576\\
    13 & 12 & $\sim$2/0.2 & $72\times72$ & 576\\
    21 & 13 & $\sim$8/0.8 & $72\times72$ & 576\\
    31 & 14 & $\sim$10/1 & $72\times72$ & 576\\
    \bottomrule
  \end{tabular}
\end{table}

Scintillator plates, $10\times10 cm^2$ and $50\times50 cm^2$, placed in front and back of the calorimeter are used as a trigger signal that is provided to the AHCAL DAQ to validate events \cite{Kvasnicka:CR_IEEE2016}. Additionally, the coincidence signal from the scintillators is provided directly via charge injection to several channels of the AHCAL in order to provide a reference time of the trigger as shown in Table \ref{table:trigger_ref}. A Cherenkov detector, at around 100 m upstream, was available to tag incoming particles.

\section{Simulation}

The AHCAL simulation model is based on the \mokka \cite{MoradeFreitas:2002kj} framework v08-05-01 and the new \ddhep \cite{Frank:2014zya} framework v00-16, using the \geant v10.1 simulation \cite{Agostinelli2003}. A right-handed coordinate system is used such that the Z-axis points in the beam direction and that the Y-axis is directed upwards. No beamline instrumentation is simulated except the scintillator triggers in front of and behind the detector. A similar amount of material is achieved by filling the world volume with air and by adding 5.6 mm of lead ($\sim$ 1 X$_0$) directly at the calorimeter front face in order to account for missing upstream material. The beam gun is placed 1 m from the calorimeter front face and it is configured to generate single beam particles with a 2\% momentum spread according to the beamline parameters. Muons and electron showers are simulated using the QGSP\_BERT\_HP physics list. Pion showers are simulated using QGSP\_BERT, QGSP\_BERT\_HP and QBBC physics lists.

The \mokka and \ddhep simulations have been checked to give consistent results. In the following, only the results with the \ddhep simulation are shown.

\subsection{Geometry and Digitization}
\label{sec:GeoDigi}

The AHCAL simulation model consists of 32 absorber layers and 14 active modules. Each absorber layer is made of stainless steel 17.2 mm thick. Each active layer is primarily composed of 1 mm steel cassette, 0.7 mm PCB, 2 or 3 mm scintillator strip or tile. The density and composition of the scintillator are taken as default provided in \geant.

The beam profile is generated using a particle gun placed 1 m upstream of the calorimeter front. For muons, a flat beam profile is used and is not expected to impact the MIP response. For electrons and pions, a 2D Gaussian beam is assumed. The mean and sigma of the Gaussian beam are estimated from data using the energy-weighted center of gravity in the x and y-axis.

The digitization of simulated hits is very similar to the previous AHCAL physics prototype \cite{1748-0221-5-05-P05004}. Individual calibration factors obtained from data are used to extract the light yield which is needed to model the statistical fluctuations of photons hitting a SiPM \cite{Hartbrich:2016bbz}. Saturation effects are also included using a global parameter, the number of pixels available on each SiPM type, as no measurement of the saturation curve is available. Most of the tiles used are wrapped with a reflective foil such that optical crosstalk effects between channels can be neglected. For modules with no wrapping, a default value of 15\% for the cross-talk is used based on previous measurements with the AHCAL physics prototype \cite{Gunter:2015ika}. A variation of the cross-talk parameter between 10\% and 18\% is used for systematics (see section \ref{sec:syst_uncert}). Noise is extracted from muon runs and overlaid onto simulated events. Dead channels and channels without calibration factors (MIP, gain, pedestal) are rejected.

The timing of simulated hits is modeled according to the hit time measurement in the SPIROC2b. The energy from sub-hits, equivalent to a \geant step, in a cell is integrated over a sliding time window of 15 ns, if the energy sum of the sub-hits in this time window passes the energy threshold, the time of the sub-hit passing the energy threshold is used as the time of the simulated hit. To simulate detector resolution effects, the time of a simulated hit is smeared with a double Gaussian function, with parameters determined from data. In addition, it is convoluted with a Gaussian function with a sigma depending on the number of triggered channels in a chip parametrized from data (see section \ref{sec:NumberTrigger}).

After the digitization, all simulated hits have the same format as raw data hits and are reconstructed with the same software chain that is used for data. To suppress noise hits, only hits above 0.5 MIP are considered in this study.

\subsection{AHCAL Model Validation}

Prior to the time analysis, the simulation and digitization are validated. Comparisons of electromagnetic interactions in the AHCAL are done as such interactions should be well described in simulation. Firstly, the simulation must be validated at the lowest hit energies. The comparison of the spectrum of a MIP-like particle traversing the AHCAL is shown in figure \ref{fig:MIPData_MC}. The shape of the spectrum matches relatively well. The simulation is slightly more narrow than the data because of channel-by-channel mis-calibrations that are not fully modeled in the simulation. The figure \ref{fig:ProfileMIP_Edep} shows the longitudinal mean energy profile for muon-like tracks in data and simulation. The data is reproduced by the simulations within 3-4\%. Channels for which no calibration with MIP-like particles could be determined in data are excluded from the analysis in data and simulation. A systematic on the energy scale of the calorimeter of 3.6\% is applied later on the data when looking at the dependence of the time as a function of the hit energy (see section \ref{sec:syst_uncert}).

\begin{figure}[htbp!]
  \centering
  \begin{subfigure}[t]{0.49\textwidth}
    \includegraphics[width=1\linewidth]{fig/ComparisonMCData_MIPPeak.eps}
    \caption{} \label{fig:MIPData_MC}
  \end{subfigure}
  \hfill
  \begin{subfigure}[t]{0.49\textwidth}
    \includegraphics[width=1\linewidth]{fig/ProfileMuons_Edep_DD4hep.eps}
    \caption{} \label{fig:ProfileMIP_Edep}
  \end{subfigure}
  \caption{\subref{fig:MIPData_MC}) Hit Energy Spectra for the complete AHCAL for muon like-track hits for both data and simulation. \subref{fig:ProfileMIP_Edep}) Longitudinal mean energy profile for muon like-track hits in data and the \ddhep simulation.}
  \label{fig:Val}
\end{figure}

The hit energy spectrum has also been checked for electrons. Data and simulation agree rather well within 10\% for hit energies below 10 MIPs, which is the range relevant for this analysis.

\section{Event Selection}

A more detailed description of the selections applied can be read in \cite{Brianne:2018rur}.

\subsection{Muon selection}

To select muons, an event pre-selection and a track finder \cite{Hartbrich:2016bbz} selection is performed. A cut on the maximum number of hits ($n_{hits}$) in the AHCAL is done at 20 as the number of hits should be around 1 per layer for a MIP-like particle plus the number of noise hits expected in the detector.
% Additionally, a cut on the energy-weighted center of gravity along the z-axis ($cog_{z} = \frac{\Sigma_{i} E_{i}z_{i}}{\Sigma_{i} E_{i}}$) is done between 0 and 800 mm as the center of gravity is expected to be centered in the calorimeter on the z coordinate due to muons depositing around the same energy for each layer.
The track finder algorithm selects AHCAL towers of hits in the same $x:y$ position and it rejects AHCAL towers that contain less than a certain number of hits. In order to select muons, a straight track of at least 7 hits is required in the first ten layers of the AHCAL. Outside of the inner 12x12 tile area, a straight track of at least 2 hits in the last 4 layers is required. In addition, to reject pions showering deep in the detector, no more than 2 hits are allowed per layer to account for some flexibility with noise hits. A summary of the muon selection is shown in Table \ref{table:muon_sel}. The selection efficiency is 72.5\% for muons, <0.1\% for electrons and 5\% for pions which is compatible with the fraction of pion traversing the AHCAL without hard interaction.

\subsection{Electron selection}

Electron events are needed to validate the timing behavior in simulation as well as the detector simulation model. It is important to have a clean sample of electrons to cross-check the timing calibration. An electron selection is done using the beam instrumentation and the AHCAL layer information. Events with a Cherenkov tag are used. The energy deposit in the first three AHCAL layers ($E_3+E_4+E_5$) must be over 10 MIPs. A box cut on the number of hits ($n_{hits}$) and the center of gravity in the z-direction ($cog_{z}$) is done. As the number of hits in an electron shower increases with the shower energy, this cut is energy dependent. The energy deposited in the last two layers relative to the energy deposited in the calorimeter ($(E_{13}+E_{14})/\Sigma E$) is required to be under 1\% to reject pion showers and to contain the electron shower. The electron selection is summarised in Table \ref{table:electron_sel}. The selection efficiencies are shown in Table \ref{table:eff_electron}. Even though a significant fraction of pions passes the electron selection at low energies, there is confidence that very little pion contamination is present in the data due to the pure electron beam generation with the beamline.

\begin{table}[htb!]
	\centering
	\caption{Efficiency of the electron selection for simulated electrons and pions for energies between 10 and 50 GeV. Muons are simulated at 150 GeV. The efficiency is defined as the number of events after selection divided by the number of events before selection and it is estimated from Monte-Carlo. No Cherenkov efficiency is included in the calculation as it is not simulated.}
	\label{table:eff_electron}
	\begin{tabular}{@{} llll @{}}
		\toprule
		\textbf{Beam Energy} & \textbf{$\epsilon_{\mu}$} & \textbf{$\epsilon_{e}$} & \textbf{$\epsilon_{\pi}$}\\
		\midrule
		10 GeV & <0.1\% & 96\% & 15.9\%\\
		15 GeV & <0.1\% & 95.7\% & 10.1\%\\
		20 GeV & <0.1\% & 95.2\% & 6.3\%\\
		30 GeV & <0.1\% & 93.9\% & 2.3\%\\
		40 GeV & <0.1\% & 92.7\% & 1.2\%\\
		50 GeV & <0.1\% & 91.5\% & 1.1\%\\
		\bottomrule
	\end{tabular}
\end{table}

\subsection{Pion selection}
\label{sec:pionsel}

The goal of the pion selection is to reject punch-through pions, muons and possible electron contamination. The events without a Cherenkov tag are selected. The number of hits per event($n_{hits}$) needs to be above 20 to reject most muons or punch-through pions. No cut on the center of gravity in z is done in order not to bias the start of the pion shower. The energy deposited in the two last AHCAL layers relative to the total energy ($(E_{13}+E_{14})/\Sigma E$) must be above 1\% in order to ensure that the pion showered and to reject possible electron showers. The number of hits in the two first AHCAL layers ($N_3+N_4$) must be smaller than 5 to mitigate possible particle contamination from electrons. In addition, multiple particle events were observed in the data. As no beam instrumentation could be used for rejecting these events, a rejection method based on the hit time information was developed. The method is the following: all the hits in an event are ordered in time; For each hit with a time over 50 ns, the number of hits in a timing window of 30 ns after the hit time is counted. If the number of hits is above 5, it is classified as a \textit{late cluster}. The event is rejected if there is at least one late cluster ($n_{Cluster}$). If an event has several particles, the time reference will be given by the first particle. Therefore, all the hits coming from the second particle will be delayed relative to the time reference. These events need to be rejected as they can influence the amount of late hits in the time distribution. The multi-particle event rejection has been checked on simulated data and affects the selection between <0.1\% up to 2\% from 10 to 90 GeV pions. These multi-particle events are also suppressed in data. The number of events removed varies between 0.1\% and 1\% depending on the beam energy. However, due to the calorimeter not being fully equipped thus providing limited information, some contamination by multi-particle may remain in the data. The Table \ref{table:pion_sel} shows the selection cuts for the pion data. The selection efficiencies are shown in Table \ref{table:eff_pion}

\begin{table}[htb!]
	\centering
	\caption{Efficiency of the pion selection for beam energies between 10 and 90 GeV. Muons are simulated at 150 GeV. The efficiency is defined as the number of events after selection divided by the number of events before selection and it is estimated from Monte-Carlo. No Cherenkov efficiency is included in the calculation as it is not simulated.}
	\label{table:eff_pion}
	\begin{tabular}{@{} llll @{}}
		\toprule
		\textbf{Beam Energy} & \textbf{$\epsilon_{\mu}$} & \textbf{$\epsilon_{e}$} & \textbf{$\epsilon_{\pi}$}\\
		\midrule
		10 GeV & <0.1\% & <0.1\% & 29.9\%\\
		30 GeV & 0.9\% & <0.1\% & 50.3\%\\
		50 GeV & 0.9\% & <0.1\% & 51.1\%\\
		70 GeV & 0.9\% & <0.1\% & 51\%\\
		90 GeV & 0.9\% & <0.1\% & 50.2\%\\
		\bottomrule
	\end{tabular}
\end{table}

\section{Timing calibration of the AHCAL}

In a first step, the muon data is used to determine the parameters for the timing calibration. Muons are used because the process they induce is quasi-instantaneous. In a second step, the calibration is cross-checked using the electron data as also processes induced by EM showers are quasi-instantaneous. This enables a verification of the time calibration procedure and may reveal effects that are not present in the muon data. In the following, the hit time of a channel is referred to as \textit{the time of the first hit} because only the first hit per channel is registered during a bunch-crossing (multiple hits could occur in a channel but only the first one is kept by the front-end).

\subsection{Time recording in the SPIROC2b}

The SPIROC2b ASIC can readout 36 SiPM-channels. It is capable to measure the charge with two gains (high and low gain) and the time for each channel. Each channel is equipped with an analog memory, called memory-cells, with a depth of 16 events to store the energy and time measurement. Additionally, the ASIC can be operated in external or auto-trigger mode with a configurable threshold. The ASIC has two multiplexed TDC voltage ramps to avoid dead time between each clock cycle. The two voltage ramps are common to all channels on the ASIC. The time information provided by the SPIROC2b in the data is in TDC units. The TDC information of each channel can be converted into nanoseconds following the schematic shown in figure \ref{fig:ConvertTime}.

\begin{figure}[htbp!]
  \centering
  \includegraphics[width=0.9\linewidth]{fig/TDCRamp.eps}
  \caption{Schematic of the TDC ramp in the SPIROC2b used in testbeam with a slow clock of 250 kHz. The slope of the ramp is $s = (Max-Ped)/\Delta{}t$.} \label{fig:ConvertTime}
\end{figure}

In order to determine the ramp slope, the starting point or pedestal of the ramp and the endpoint of the ramp are measured. Since the SPIROC2b has two TDC ramps, each defined by the parity (even or odd) of the clock cycle counter or bunch-crossing ID (BXID), two slopes need to be extracted per chip. The differences between memory-cells lead to offsets in pedestals, thus 16 calibration values are needed per channel. The time of the hit in the i-th channel is then calculated as the following:
\begin{equation}
  t_{i} [ns] = 1/s \times (TDC_{i} - Ped)
\end{equation}
where Ped is the pedestal of the i-th channel in the first memory cell without taking into account the bunch-crossing parity. The extraction of the slope and the determination of the pedestal is described in the following sections.

\subsection{Timing calibration procedure}

The timing calibration procedure of the AHCAL is quite complex. An overview of the steps performed for the time calibration of each individual AHCAL channel is shown in figure \ref{fig:CalibOverview}.

\begin{figure}[htbp!]
  \centering
  \includegraphics[width=1\linewidth]{fig/TimeCalibOverview.eps}
  \caption{Overall view of the different steps performed for the AHCAL timing calibration. In total, more than 20000 constants are needed.} \label{fig:CalibOverview}
\end{figure}

\subsection{Slope and Pedestal extraction}

To reconstruct the time in a channel, the TDC value measured needs to be converted into nanoseconds. The slope is calculated as
\begin{equation} \label{eq:slope}
  s \: \text{[TDC/ns]} = \frac{b - a}{3920}
\end{equation}
where $s$ is the TDC ramp slope, $b$ is the endpoint of the TDC ramp and $a$ is the start point of the TDC ramp that is referred to in the following as the pedestal. The total length of the ramp is 3920 ns instead of the expected value of 4000 ns due to a deadtime of around 2\% \cite{Brianne2012} induced by the multiplexer that switches between the two TDC ramps.

\begin{figure}[htbp!]
  \begin{subfigure}[t]{0.49\textwidth}
    \centering
    \includegraphics[width=1\linewidth]{fig/ExampleTDCSpectra.eps}
    \caption{} \label{fig:TDC_Spectrum}
  \end{subfigure}
  \hfill
  \begin{subfigure}[t]{0.49\textwidth}
    \centering
    \includegraphics[width=1\linewidth]{fig/SlopesTDC.eps}
    \caption{} \label{fig:slopes}
  \end{subfigure}
  \caption{\subref{fig:TDC_Spectrum}) TDC spectrum of a typical chip. The vertical black lines indicate the fitted Max and Pedestal parameters for this chip. The horizontal red line represents the mean $\mu$ of the histogram on the y-axis used for the determination of the parameter $a$ as the value of the first bin above 30\% of $\mu$. The parameter $b$ is extracted as the value of the last bin above 50\% of the maximum bin. The extracted parameters are $1/s$ = 1.44 $\pm$ 0.01 ns/TDC, $a$ = 888 $\pm$ 5 TDC and $b$ = 3613 $\pm$ 8 TDC. \subref{fig:slopes}) Distribution of the fitted slopes for even and odd bunch-crossing IDs. $\mu_{odd}$ = 1.564 ns/TDC, RMS$_{odd}$ = 0.121, $\mu_{even}$ = 1.556 ns/TDC, RMS$_{even}$ = 0.113. In total, 208 TDC slopes were extracted.}
\end{figure}

To first order, the slope of the TDC ramp is assumed to be linear. The parameters $a$ and $b$ are extracted from the TDC spectrum per chip (combining all channels) and BXID parity using only the first memory-cell as shown in figure \ref{fig:TDC_Spectrum}. The TDC ramp slope does not depend on the memory-cell as the memory-cell only introduce an offset on the parameters $a$ and $b$. A total of 208 slopes have to be extracted for the testbeam setup.

The extracted values for the inverse of the slope are shown in figure \ref{fig:slopes}. They are in the expected range of 1.6 ns per TDC bin due to the limited dynamic range provided by the chip, of around 2500 TDC bins for 4 $\mu$s.

The same method is used to determine the pedestal for each channel using only the first memory cell without taking into account the bunch-crossing parity. Any time offsets introduced by the other memory cells and the bunch-crossing parity are corrected in section \ref{sec:TimeOffset}.

\subsection{Time reference calibration}

The channels recording the signal from the trigger scintillators (see Table \ref{table:trigger_ref}) are calibrated using the same method described above. This is used later on in the analysis as a time reference ($T_{ref}$) compared to all channels ($t_{hit} - T_{ref}$). To guarantee the most accurate result, the pedestal value is extracted for each memory cell. Since a signal from the trigger scintillators with defined amplitude was injected in these channels, a corresponding amplitude range is required to reject noise hits from these channels. A 2$^{nd}$ order polynomial correction w.r.t T$_{14}$ is done to remove any effects induced by the front-end electronics. This correction is equivalent to a non-linearity correction of T$_{12}$ or T$_{13}$ relative to T$_{14}$ similar to the procedure shown in section \ref{sec:Non-linCorr}. In this case, T$_{14}$ is not corrected for non-linearity.

Ideally, the T$_{12}$ - T$_{14}$ and T$_{13}$ - T$_{14}$ distributions should be a Gaussian distribution centered at 0 ns. The figure \ref{fig:T0Corr} shows the distribution of T$_{12}$ - T$_{14}$ before and after the correction. The correction with the 2$^{nd}$ order polynomial corrects for the non-linearity between the time reference channels as well as it corrects at the same time for the difference of pedestals with the bunch-crossing parity which was not expected.

\begin{figure}[htbp!]
  \begin{subfigure}[t]{0.49\textwidth}
    \centering
    \includegraphics[width=1\linewidth]{fig/T0_Resolution_5.eps}
    \caption{} \label{fig:T0Corr}
  \end{subfigure}
  \hfill
  \begin{subfigure}[t]{0.49\textwidth}
    \centering
    \includegraphics[width=1\linewidth]{fig/T0ReferenceError.eps}
    \caption{} \label{fig:TRefErr}
  \end{subfigure}
  \caption{\subref{fig:T0Corr}) Time difference between the trigger channels before and after correction for T$_{12}$ and T$_{14}$. $\mu_{corrected}$ = 0.78 ns, RMS$_{corrected}$ = 4.28 ns. The two peaks in blue are due to the fact that the pedestal value is dependent on the bunch-crossing parity. \subref{fig:TRefErr}) Distribution of the time reference uncertainty. The red line represents the cut of 4 ns.}
\end{figure}

Finally, the time reference ($T_{ref}$) is calculated as the mean of T$_{12}$, T$_{13}$ and T$_{14}$ per event. To reject events with a too large time reference uncertainty ($\sigma_{T{ref}} = \sqrt{\Sigma_i (T_{i} - T_{ref})^{2}/N}$), a cut of 4 ns on the time reference uncertainty is applied. The mean uncertainty of the time reference is around 1.30 ns as shown in figure \ref{fig:TRefErr}. This resolution from the time reference contributes to the final timing resolution obtained.

\subsection{Time offset correction}
\label{sec:TimeOffset}

The time reference of the trigger is delayed compared to the muon passing through the detector because of the length of cables and the trigger electronics logic. Therefore, the time offset of the time reference is determined from data. The physical process induced by muons is instantaneous, therefore the difference of the hit time and the time reference for each channel, memory cell and BXID should be a distribution that is centered at 0 ns.

\begin{figure}[htbp!]
  \centering
  \includegraphics[width=0.6\textwidth]{fig/Timing_Chip236_Chn21_Mem01_BXID1_withOffset.eps}
  \caption{Time of first hit distribution for a single channel (Chip 236, Chn 21, Mem 01, BXID 1). An offset of -165.3 ns is determined for this channel.}\label{fig:TimeChnwithOffset}
\end{figure}

A shifting procedure of the time of the hit relative to the time reference for each channel, memory-cell and BXID parity is performed. This is done to take into account the delay time of the trigger due to cabling and the trigger electronics as well as possible differences in channel pedestals. Only memory-cells containing more than 100 events are considered. The histogram range of the time of the hit relative to the time reference is reduced iteratively, in the range $t_{max} \pm RMS$ with $t_{max}$ corresponding to the time at the center of the maximum bin of the histogram, until the RMS of the distribution is smaller than 10 ns. This value corresponds to more than 3 sigmas of the time reference uncertainty. The mean of the histogram is then used as the time offset value. An example of a single channel is shown in figure \ref{fig:TimeChnwithOffset}.

In total, 21040 individual offsets are extracted from data. The mean value of the time offset is around -150 ns which is around the expected value considering the cabling length and the trigger logic delay. This procedure also corrects for the time of flight of particles within the detector.

\subsection{Non-linearity correction}
\label{sec:Non-linCorr}

The time calibration relies on the linearity of the TDC voltage ramp in the \textit{SPIROC2B}. However, this assumption is not entirely reliable as described in \cite{Hartbrich2011, Brianne2012}. The voltage slope shows a slight kink around the middle thus leading to a non-linear ramp. For this, a correction of the non-linearity is applied. By investigating the time of the first hit for each chip and BXID parity as a function of the TDC value of the hit, the shape of the graph indicates how reliable is the assumption of a linear ramp. If the ramp would be perfectly linear, one would obtain a flat graph. To correct for the non-linearity of the ramp, a $2^{nd}$ order polynomial is used. An example of a typical chip is shown in figure \ref{fig:NLCorr}. The time resolution before and after the non-linearity correction are compared in figure \ref{fig:TimingNLCorr}, showing an improvement by about 5.1\%.

\begin{figure}[htbp!]
  \begin{subfigure}[t]{0.49\textwidth}
    \centering
    \includegraphics[width=1\linewidth]{fig/LinearityCorrection_Module09_Chip146_BXID0.eps}
    \caption{} \label{fig:NLCorr}
  \end{subfigure}
  \hfill
  \begin{subfigure}[t]{0.49\textwidth}
    \centering
    \includegraphics[width=1\linewidth]{fig/Timing_AHCAL_LinCorrection.eps}
    \caption{} \label{fig:TimingNLCorr}
  \end{subfigure}
  \caption{\subref{fig:NLCorr}) Dependence of the mean time of the first hit as a function of the raw hit time in TDC units for chip 146 (BXID even) on layer 9. The quadratic fit is slightly curved showing that this chip presents a non-linear TDC ramp. \subref{fig:TimingNLCorr}) Time of the first hit distribution before and after the non-linearity correction. The correction results in an improvement of around 5\% on the RMS of the distribution.}
\end{figure}

\subsection{Time-walk correction}
\label{sec:TWCorr}

The time-walk effect is due to the presence of an energy threshold that induces a time shift between a small amplitude signal and a high amplitude signal. Small amplitude signals will systematically trigger at a later time than high amplitude signals for a shaper that makes the signals peak at the same time. A time correction is determined by looking at the time of the first hit as a function of the amplitude of the hit as shown in figure \ref{fig:time_walk}. This may be particularly relevant for late energy depositions in hadron showers that comes generally from neutrons depositing little energy in the calorimeter. An improvement of around 3\% is achieved on the time resolution of the AHCAL as shown in figure \ref{fig:Timing_AllCorr}.

\begin{figure}[htbp!]
  \begin{subfigure}[t]{0.49\textwidth}
    \centering
    \includegraphics[width=1\linewidth]{fig/TimeWalkProfile.eps}
    \caption{} \label{fig:time_walk}
  \end{subfigure}
  \hfill
  \begin{subfigure}[t]{0.49\textwidth}
    \centering
    \includegraphics[width=1\linewidth]{fig/Timing_AHCAL_AllCorrection.eps}
    \caption{} \label{fig:Timing_AllCorr}
  \end{subfigure}
  \caption{\subref{fig:time_walk}) Time of first hit as a function of the hit energy. A difference up to 6 ns is seen between small and large amplitudes. Time-walk correction extracted from data. The fit function is of the form $\text{A} \times e^{-\lambda{}x} + \text{B}$. \subref{fig:Timing_AllCorr}) Time of the first hit distribution before and after the time-walk correction. The correction results in an improvement of around 3\% on the RMS of the distribution.}
\end{figure}

\subsection{Triggered channel occupancy correction}
\label{sec:NumberTrigger}

After the time calibration, electrons show a significantly worse time resolution than muons. This was traced back to events where there are many channels that are triggered in the same chip. The mean time of the first hit as a function of the number of triggered channels above 0.5 MIP in a chip, $N_{trig/chip}$, is shown in figure \ref{fig:nhits_profile}. A time shift of up to 20-40 ns can be seen depending on  $N_{trig/chip}$. The cause of the observed effect is most likely due to an element in the chip called a \textit{delay box} that gets unstable with a high charge going through the chip. This chip element is responsible for the hold signal of the TDC ramp in the chip. The hold signal is delayed, and thus a higher TDC ramp value than the one expected is sampled.

\begin{figure}[htbp!]
  \begin{subfigure}[t]{0.49\textwidth}
    \centering
    \includegraphics[width=1\linewidth]{fig/NumberHits_Dependance_AllEnergies.eps}
    \caption{} \label{fig:nhits_profile}
  \end{subfigure}
  \hfill
  \begin{subfigure}[t]{0.49\textwidth}
    \centering
    \includegraphics[width=1\linewidth]{fig/ParametrisationPedestalShift_20GeV.eps}
    \caption{} \label{fig:nhits_RMS_profile}
  \end{subfigure}
  \caption{\subref{fig:nhits_profile}) Mean time of the first hit as a function of the number of triggered channels above 0.5 MIP, $N_{trig/chip}$, in a chip. The mean time shift upwards with the increase of triggers leading to large tails in the time distribution. A second order polynomial fit is done for the time correction shown by the red dashed line. \subref{fig:nhits_RMS_profile}) RMS of the time distribution for 20 GeV electrons as a function of  $N_{trig/chip}$.}
\end{figure}

This effect not only shifts the mean time of the first hit but as well it increases the RMS of the time distribution as shown in figure \ref{fig:nhits_RMS_profile} for 20 GeV electrons. In order to determine a reliable time correction, the time correction parameters are determined by combining all the electron data. This effect may be chip-dependent and the parameters for the correction may differ from chip to chip. However, the limited amount of data does not allow to determine a correction function for each chip. In addition, the layers deeper in the calorimeter, which are most interesting for the pion analysis, are not reached by electrons. Therefore, a global function is used to correct the time in the data. This effect is parametrized in simulation as explained in section \ref{sec:GeoDigi}.

\begin{figure}[htbp!]
  \centering
  \includegraphics[width=0.6\textwidth]{fig/CheckCorrection.eps}
  \caption{Residuals of the mean time of the first hit as a function of the number of triggered channels above 0.5 MIP in a chip after correction. The correction has been applied to all electron samples separately to evaluate the systematic uncertainty. The vertical red lines delimit the three sections used for the systematic uncertainty.}
  \label{fig:Nhit_residuals}
\end{figure}

Figure \ref{fig:Nhit_residuals} shows the residuals of the mean time of the first hit as a function of $N_{trig/chip}$ after the correction. The correction has been applied to all electron samples separately in order to evaluate the systematic uncertainty of the correction. Three ranges in $N_{trig/chip}$ have been defined to estimate the uncertainty. Half of the residual envelope is taken as uncertainty. For 0 < $N_{trig/chip}$ < 5, a systematic uncertainty of 2 ns is taken, For 5 $\leq$ $N_{trig/chip}$ < 12, a systematic uncertainty of 5 ns is taken and finally for $N_{trig/chip}$ $\geq$ 12, a systematic of 7 ns is taken.

\section{Results}

\subsection{Systematic uncertainties}
\label{sec:syst_uncert}

Systematic uncertainties are evaluated in order to perform a significant assessment of differences observed between data and simulations. The following sources of systematic uncertainty are taken into account for data:
\begin{itemize}
  \item Non-Linearity correction: A correction for the non-linearity of the TDC ramps is determined from data with a limited accuracy, leading to a systematic uncertainty. The residuals of the correction give a systematic uncertainty at the level of 0.2 ns.
  \item Time walk correction: Similarly to the non-linearity correction, the systematic uncertainty obtained from the residuals of the time walk correction in data is in the order of 0.2 ns.
  \item Number of triggered channels correction: The correction in data for $N_{trig/chip}$ results in a residual on the mean time of the first hit as shown in section \ref{sec:NumberTrigger}. The uncertainty for the mean time of the hit is computed \textit{for each bin of hit energy and hit radius} by weighting according to the fraction of hits in each of the three regions following equation \ref{eq:syst_nHits}. As the uncertainties in the three ranges are correlated, a conservative way is to add linearly the uncertainties.

  \begin{equation}
    \sigma = n_1 \times \sigma_1 + n_2 \times \sigma_2 + n_3 \times \sigma_3 \label{eq:syst_nHits}
  \end{equation}

  with $\sigma_1$ = 2 ns, $\sigma_2$ = 5 ns, $\sigma_3$ = 7 ns, $n_1$ the fraction of hits for the i-th bin in the region 0 < $N_{trig/chip}$ < 5, $n_2$ the fraction of hits for the i-th bin in the region 5 $\leq$ $N_{trig/chip}$ < 12 and $n_2$ the fraction of hits for the i-th bin in the region $N_{trig/chip}$ $\geq$ 12 and such as $n_1 + n_2 + n_3$ is equal to one in the i-th bin. The resulting systematic uncertainty varies between 2 to 3.9 ns. For the time of first hit distribution, a systematic uncertainty is applied bin-by-bin for electrons and pions in the region of -30 ns to 30 ns. Outside of this region, a systematic error of 50\% is taken. This systematic uncertainty is the most dominant over all other uncertainties.
  \item AHCAL energy scale: The energy scale of the AHCAL was determined using the muon dataset. A systematic uncertainty on the MIP scale of around 3.6\% was derived by dividing the muon sample in odd and even run numbers and by looking at the average spread of the fitted MIP value for both subsamples. This is converted to an uncertainty in time using the mean time of the first hit as a function of the hit energy using the QGSP\_BERT\_HP physics list. At 0.5 MIP, this results in an uncertainty of 0.1 ns. For hits above 1 MIP, the uncertainty is below 0.05 ns.
\end{itemize}
The following systematic uncertainties are taken into account for the simulation:
\begin{itemize}
  \item Global time smearing parameters: A global time smearing parametrization is determined from muon data and is used to smear the time in the simulation. A bin-by-bin systematic uncertainty is applied to the time of first hit distribution in simulation to take into account the difference with a layer-wise time smearing parametrization.
  \item Time smearing as a function of $N_{trig/chip}$: A smearing parametrization of the width of the time distribution as a function of $N_{trig/chip}$ is obtained from electron data. An error band on the width was obtained by comparing all electron energies. The minimum and maximum borders of the error band are used to derive a systematic uncertainty for the simulation.
  \item Determination of the offset to $t=0$: For simulation, the time shift per layer is calculated using a time of flight correction $T_{of} = \frac{z_{layer}}{c}$ with $c$ the speed of light and $z_{layer}$ the z position of a layer. For this, an uncertainty of 3 mm corresponding to the scintillator thickness is taken in z corresponding to 0.01 ns uncertainty in timing.
  \item Cross-talk: No measurement for optical cross-talk between tiles is available. From previous measurements with the AHCAL physics prototype, the cross-talk value varies between 10\% and 18\%. The cross-talk value induces a different number of hits in the detector thus has an impact on the width of the time of first hit distribution. The variation of this parameter in the simulation for the modules 4 to 10 is used for systematics.
  \item Normalisation of the pion dataset: When comparing the number of hits per time bin between data and simulation, there is an uncertainty related to the number of true pion events in the dataset. This number is perfectly known for simulation, however in data, an uncertainty is present due to some possible contamination from multi-particle events after the selection. The cluster time rejection method (see section \ref{sec:pionsel}) rejects up to 1\% of events in the data. A conservative uncertainty of 10\% on the data normalization is assigned when comparing data to simulation for the absolute time of first hit distribution of pions.
\end{itemize}

The systematic uncertainties are added in quadrature for the full systematic uncertainty assuming no correlation between uncertainties. For the mean time of the first hit as a function of the hit energy and as a function of the hit distance to the shower center of gravity, the systematic uncertainty is resulting at 0.3 ns for muons and between 2 to 4 ns for electrons and pions. Table \ref{table:time_syst} summarizes the systematic uncertainties used in the analysis.

\begin{table}[htb!]
  \centering
  \caption{Summary of systematic uncertainties.}
  \label{table:time_syst}
  \resizebox{\textwidth}{!}{\begin{tabular}{@{} lc @{}}
    \toprule
    \multicolumn{1}{c}{Uncertainty source} & Full uncertainty \\
    \midrule
    Non-linearity correction & 0.2 ns \\
    Time-walk correction & 0.2 ns \\
    Number of triggered channels correction & 2 - 3.9 ns (mean) 1.2 - 2 (RMS) / bin-wise (e/$\pi$)\\
    Energy Scale & 0.05-0.1 ns \\
    Time of flight offset & 0.01 ns (MC) \\
    Cross-talk parameter & 10-18\% (MC)\\
    Global time smearing parameters & bin-wise (MC)\\
    Number of triggered channels in a chip parametrization & bin-wise (MC)\\
    Multi-particle events & 10\% ($\pi$) \\
    \midrule
    \midrule
    \multicolumn{2}{c}{Resulting systematic uncertainties per distribution} \\
    \midrule
    data-MC ToFH distribution (figures \ref{fig:sim_data_muon} to \ref{fig:dNdt_SimData_50GeV_DD4hep})& bin-wise (e) - bin-wise + 10\% ($\pi$) \\
    data-MC vs hit energy (figure \ref{fig:Energy_SimData_50GeV}) & 0.3 ns ($\mu$) - 2 to 4 ns (e/$\pi$)\\
    data-MC vs hit distance to shower CoG (figures \ref{fig:Radius_SSF_SimData_50GeV} to \ref{fig:Radius_Individual_Data_50GeV}) & 0.3 ns ($\mu$) - 2 to 4 ns (e/$\pi$)\\
    % data-MC vs hit depth & 0.3 ns ($\mu$) - 1.8 to 3 ns (e/$\pi$)\\
    \bottomrule
  \end{tabular}}
\end{table}

\subsection{Timing of muon and electron beams}

The comparison of the time of first hit distribution for muons between data and simulations is shown in figure \ref{fig:sim_data_muon}. The comparison shows that in the range of -20 ns to 20 ns, data and simulation agree well within the uncertainties. In this range the smearing with a double-Gaussian in the simulation describes the data well. However, outside this range, the simulation underestimates the tails. This is probably caused by the noise implementation in simulation that does not perfectly reproduce the data. The time of the first hit distribution has been checked layer-by-layer and compared to simulations. Similarly, the agreement between data and simulations is best in the range of -20 ns to 20 ns and the tails are not perfectly reproduced in simulation.

\begin{figure}[htbp!]
  \centering
  \includegraphics[width=0.6\textwidth]{fig/Comparison_MokkaDD4hepData_Muons_DD4heponly.eps}
  \caption{Time of first hit distribution for muons in data and the \ddhep simulation between -50 and 50 ns. The grey area represents the statistical uncertainty of the data. The error bars of the simulation are obtained by varying the cross-talk parameter between 10\% and 18\% and taking into account the error of a global time smearing parametrization.}
  \label{fig:sim_data_muon}
\end{figure}

In order to further validate the time simulation, a comparison with electron data has been done. Figure \ref{fig:elec_sim_data_50GeV} shows the comparison of the time of first hit distribution for 50 GeV electrons in data and simulation. The simulation is slightly wider than the data. This is caused by the simulation having more hits in a chip than data which can be seen in figure \ref{fig:elec_sim_data_nHits_50GeV}. The simulation lies above the data in the region of 10 to 14 hits per chip. Overall, the simulation describes well the data within statistical and systematic uncertainties in the central region of -30 ns to 30 ns for all energies. The large error bars in the simulation are due to the parametrization of the increase of the width as a function of the number of triggered channels in a chip. However, the description of the tails of the time of the first hit distribution in the simulation is underestimated. Like for muons, this is due to the description of the noise in the simulation that is not perfectly reproduced.

\begin{figure}[htbp!]
  \centering
  \begin{subfigure}[t]{0.49\textwidth}
    \includegraphics[width=1\textwidth]{fig/Comparison_SimData_Electrons50GeV_DD4heponly.eps}
    \caption{}\label{fig:elec_sim_data_50GeV}
  \end{subfigure}
  \hfill
  \begin{subfigure}[t]{0.49\textwidth}
    \includegraphics[width=1\textwidth]{fig/Comparison_SimData_Electrons_nHits_50GeV_DD4heponly.eps}
    \caption{}\label{fig:elec_sim_data_nHits_50GeV}
  \end{subfigure}
  \caption{\subref{fig:elec_sim_data_50GeV}) Comparison of the time of first hit between data and the \ddhep simulation for 50 GeV electrons. The grey area represents the statistical and systematical error of the data. Error bars in simulation are obtained by varying the cross-talk parameter between 10\% and 18\% and with the uncertainty on parametrization of the width of the time distribution as a function of the number of triggered channels in a chip. \subref{fig:elec_sim_data_nHits_50GeV}) Comparison of the number of triggered channels per chip between data and simulations for 50 GeV electrons. The grey area represents the statistical error of the data. Error bars in simulation are obtained by varying the cross-talk parameter between 10\% and 18\%.}
\end{figure}

\subsection{Timing of pion showers}

Figure \ref{fig:dNdt_Data} shows the time of first hit for muons, 10 GeV electrons and 50 GeV pions. The muon and electron distributions are centered around 0 ns within a certain time window that is determined by the intrinsic time resolution of the detector. Isolated hits are present in the tails most likely caused by SiPM thermal noise.

\begin{figure}[htbp!]
  \centering
  \begin{subfigure}[t]{0.49\textwidth}
    \includegraphics[width=1\textwidth]{fig/Timing_dNdt_Comparison.eps}
    \caption{}\label{fig:dNdt_Data}
  \end{subfigure}
  \hfill
  \begin{subfigure}[t]{0.49\textwidth}
    \includegraphics[width=1\textwidth]{fig/Comparison_SimData_Pion50GeV_LateClusters_DD4hep_Ratio.eps}
    \caption{}\label{fig:dNdt_SimData_50GeV_DD4hep}
  \end{subfigure}
  \caption{\subref{fig:dNdt_Data}) Time of first hit for muons, electrons and pions in steel absorber in a range of -100 to 250 ns. The histograms are normalized to the number of events where at least one hit was identified. The errors bars are statistical and systematic uncertainties. The lines represent the fit to the data as explained in the text. \subref{fig:dNdt_SimData_50GeV_DD4hep}) Comparison of the time of first hit distribution for 50 GeV pions in data and three different physics list for the \ddhep simulation. The grey and color bands shows the statistical and systematic uncertainties.}
\end{figure}

The noise level is similar on the left side of the time distribution for muons, electrons and pions giving confidence that the right tail observed between 30 to 50 ns in the pion data is coming from physics and not noise. A model of the sum of two exponentials and a constant is used, similar to the T3B experiment \cite{Simon2013}, to characterize the slow and fast time component of the distribution.

A fast component of $6.21 \pm 0.30$ ns and a slow component of $343 \pm 39$ ns are extracted. The time constant of the fast component is in the same order of magnitude as given by the T3B experiment (8 ns). However, due to the time resolution of the AHCAL being in the same order of magnitude, it is difficult to confirm the observation made by T3B. The time constant of the slow component is very different than in the T3B experiment (around 80 ns in steel). It may be due to the contribution of SiPM noise that reduces the sensitivity to the slow component of the shower, and the contribution of multi-particle events. The model may be incomplete as the fitting function does not match well the data in the transition region of 50 to 100 ns.

Figure \ref{fig:dNdt_SimData_50GeV_DD4hep} shows the distribution of the time of the first hit compared to three different physics lists for 50 GeV pions. For the core of the distribution below 50 ns, all physics lists describe the data within the systematics. The late tail is described best by the QGSP\_BERT\_HP and QBBC physics lists. The QGSP\_BERT physics list without the precision treatment of neutron results in an overestimation of the tail of the distribution by around a factor of 5.

The dependence of the time of the first hit on the hit energy is studied in the following. It is expected that there is no hit energy dependence for muon and electron beams. On the other hand, for pions, it is expected that low energy hits mostly coming from neutron signals in the calorimeter are delayed. Figure \ref{fig:Energy_SimData_50GeV} shows the comparison of the mean time of first hit as a function of the hit energy in data and simulation for 50 GeV pions.

In general, data and all simulations show a rise of the mean time of the first hit towards small hit energies, although the large systematic uncertainties on the data make a firm statement difficult. This behavior is consistent with the expectation that low energy hits are responsible for delayed energy depositions in the calorimeter, most likely due to low energy neutrons from capture and spallation processes, while higher energy deposits occur mostly in the prompt part of the hadron shower. The rise in data is located at hit energies below 1 MIP, while it extends up to $~4$ MIP in the simulation. A difference is visible between the physics lists mainly between hit energies of 1-3 MIPs, where QGSP\_BERT\_HP lies below QGSP\_BERT and QBBC. In this range, and at higher MIP values, all physics lists agree within the large systematic uncertainties with the data.

\begin{figure}[htbp!]
  \centering
  \includegraphics[width=0.6\textwidth]{fig/Time_Energy_50GeV_DD4hep.eps}
  \caption{Comparison of the mean time of first hit as a function of the hit energy in data and \ddhep simulation for 50 GeV pions. The grey and color bands shows the statistical and systematic uncertainties.}
  \label{fig:Energy_SimData_50GeV}
\end{figure}

The prompt component of a hadron shower is dominated by EM sub-showers and relativistic particles, whereas the delayed component is coming from mostly evaporation and spallation low energy neutrons. It is expected that the former is concentrated near the shower axis, while the latter is spread out laterally as these neutrons can travel far away in the calorimeter before interacting. Therefore, the radial dependence of the time of the first hit of 50 GeV pion showers is studied. It is studied separately for modules 3 to 10 (small modules) and modules 11 to 14 (big modules) as significant differences were found (figure \ref{fig:Radius_SSF_SimData_50GeVComparison}). Both distributions show an increase of the mean time of the first hit with the distance to the shower center, but the effect is larger for the small modules, where the mean time of the first hit is around 8 ns at 22 cm, while the large modules show an effect of less than 4 ns at the same distance.
For the modules 3 to 10, the QBBC and QGSP\_BERT\_HP physics lists reproduce well the data within systematics while QGSP\_BERT lies above the data at large distances from the center-of-gravity of the shower. For the modules 11 to 14, the QGSP\_BERT\_HP physics list agrees the best with the data. The QBBC and QGSP\_BERT physics lists agree with data up to around 10 cm distance and then both tend to lie above the data for higher distances. The observations for other beam energies are similar. The main difference between the QGSP\_BERT\_HP and the QGSP\_BERT physics list is the detailed neutron tracking in QGSP\_BERT\_HP. The figures show that without this detailed neutron tracking, too many late energy depositions are created that are spread far away from the shower axis.

\begin{figure}[htbp!]
  \begin{subfigure}[t]{0.49\textwidth}
    \centering
    \includegraphics[width=1\textwidth]{fig/Time_Radius_50GeV_SSF_DD4hep.eps}
    \caption{Layers 3 to 10} \label{fig:Radius_SSF_SimData_50GeV}
  \end{subfigure}
  \hfill
  \begin{subfigure}[t]{0.49\textwidth}
    \centering
    \includegraphics[width=1\textwidth]{fig/Time_Radius_50GeV_BL_DD4hep.eps}
    \caption{Layers 11 to 14} \label{fig:Radius_BL_SimData_50GeV}
  \end{subfigure}
  \caption{Comparison of the time of first hit as a function of the hit distance to the shower axis in data and simulations for 50 GeV pion for the modules 3 to 10 on the left and for modules 11 to 14 on the right. The grey and color bands shows the statistical and systematic uncertainties.}
  \label{fig:Radius_SSF_SimData_50GeVComparison}
\end{figure}

By studying the modules individually, it was found that the mean time of the first hit as a function of the hit distance to the shower axis decreases with deeper modules as shown in figure \ref{fig:Radius_Individual_Data_50GeV}. Especially at larger distances, this study is limited by statistics. The simulation shows a similar behavior (figure \ref{fig:Radius_Individual_Sim_50GeV}). This behavior is related to where the pion shower starts and thus, at the depth that the shower is sampled.

\begin{figure}[htbp!]
  \begin{subfigure}[t]{0.49\textwidth}
    \centering
    \includegraphics[width=1\textwidth]{fig/Timing_Radius_Comparison_ShortAsymRange_IndividualLayers.eps}
    \caption{} \label{fig:Radius_Individual_Data_50GeV}
  \end{subfigure}
  \hfill
  \begin{subfigure}[t]{0.49\textwidth}
    \centering
    \includegraphics[width=1\textwidth]{fig/Timing_Radius_Comparison_ShortAsymRange_IndividualLayers_Sim.eps}
    \caption{} \label{fig:Radius_Individual_Sim_50GeV}
  \end{subfigure}
  \caption{Mean time of first hit as a function of the hit distance to the shower axis for 50 GeV pions for different modules. For data, on the left. For simulation using the QGSP\_BERT\_HP physics list, on the right. Both figures shows the same behavior with a decrease of the curve slope for deeper modules in the calorimeter.}
  \label{fig:Radius_SimData_50GeVComparison_Individual}
\end{figure}

% Finally, timing correlations between modules has been investigated. This is done by comparing the time of a hit in layer $i$ with the time of the closest hit in the next layer $i+1$. A maximal radial distance of 60 mm is allowed between the two hits.
%
% \begin{figure}[htbp!]
%   \begin{subfigure}[t]{0.49\textwidth}
%     \centering
%     \includegraphics[width=1\textwidth]{fig/Time_Correlation_long.eps}
%     \caption{Data} \label{fig:TimeCorr_Data_50GeV}
%   \end{subfigure}
%   \hfill
%   \begin{subfigure}[t]{0.49\textwidth}
%     \centering
%     \includegraphics[width=1\textwidth]{fig/Time_Correlation_50GeV_long_QGSPBERTHP_DD4hep.eps}
%     \caption{Simulation} \label{fig:TimeCorr_Data_50GeV_Sim}
%   \end{subfigure}
%   \caption{Hit timing correlations between modules 13 and 14 for data on the left and the \ddhep simulation with QGSP\_BERT\_HP on the right, for 50 GeV pions. Each bin is normalized to the total number of entries in the 2D histogram. The red box in the left plot represents the zone investigated to quantify the difference between data and simulation as stated in the text.}
%   \label{fig:TimeCorr_50GeV}
% \end{figure}
%
% Two types of correlations were investigated, short and long. For the short correlation, the modules 6 and 7 were chosen, separated by 1 $X_0$ or 0.1 $\lambda_{\pi}$. For the long correlations, the modules 13 and 14 were selected, separated by 10 $X_0$ or 1 $\lambda_{\pi}$. It is expected that EM sub-showers can lead to a correlation of hit times for the modules 6 and 7, while the modules 13 and 14 are far apart, and therefore would show less correlation of hit times. The long correlation is shown in figure \ref{fig:TimeCorr_Data_50GeV} for 50 GeV pions.
%
% For comparison, the \ddhep simulation using the QGSP\_BERT\_HP physics list is shown in figure \ref{fig:TimeCorr_Data_50GeV_Sim}. While the data show a clear component with hits correlated in time between the two modules, the simulation does not show this. This has been quantified by looking at the fraction of entries in a square between 50 and 2000 ns as shown by the red line in figure \ref{fig:TimeCorr_Data_50GeV}. Around $3.25 \pm 0.12$\% of the entries are in the red square in data as opposed to around $0.71 \pm 0.02$\% for the \ddhep simulation with the QGSP\_BERT\_HP physics list. This accounts for a difference of around 3\%, however, the reason is not clear. A possible reason for the correlation in data is multi-particle events, muons or punch-through pions that trigger at a later time, that are not rejected completely by the pion selection. With the limited amount of active layers available for this prototype, no further conclusions can be drawn from this study.

\section{Conclusion}

In this note, a timing study of hadronic showers with the CALICE AHCAL prototype was presented, using the data taken with steel absorber at the CERN SPS in July 2015 in muon, electron and pion beams between 10 and 90 GeV. This prototype was partially instrumented with several generations of active readout boards which do not reach the final design performance. It was operated at a lower clock speed in order to have a good efficiency in the data taking. Nevertheless, the data collected has been used to develop calibration and correction procedures, to study systematic effects and understand the simulations that reproduce the data and allow for meaningful comparisons with hadron showers.

Firstly, the timing calibration was presented. A time resolution of around 5 ns was achieved with muons and around 8 ns with electrons. The increase of the time resolution for electrons is due to an electronic effect that increases the time resolution depending on the number of hits within a chip.

Secondly, the study of the time development of pion showers was presented. The late contributions are predominant at a larger radius from the core of the shower and they are consistent with low hit energies below 1 MIP. Comparisons to simulations show that the time structure of pion showers is well reproduced by the \geant physics lists QGSP\_BERT\_HP and QBBC. The QGSP\_BERT physics list tends to over-estimate the late contribution, showing that a proper treatment of neutrons is needed to reproduce the data to a satisfactory level.

% \acknowledgments

\bibliography{biblio}
\bibliographystyle{JHEP}
% \bibliographystyle{unsrt}

\clearpage

\appendix
\section{Appendix}
\label{appendix:Additional}
\setcounter{table}{0}
\renewcommand{\thetable}{A\arabic{table}}

\begin{table}[htb!]
  \centering
  \caption{List of runs taken at SPS in July 2015. The quoted number of events includes not only physics events but also single noise hit events.}
  \label{table:dataruns}
  \begin{tabular}{@{}lp{2cm}p{7.5cm}p{2cm}@{}}
    \toprule
    \multicolumn{1}{l}{\textbf{Particle}} & \textbf{Energy} & \textbf{Runs} & \textbf{\# Events}\\
    \midrule
    \multirow{2}{*}{$\mu^-$}& 50 GeV & 24016-24204 & 120,887,651\\& 150 GeV & 24623-24662 & 15,534,328\\
    \midrule
    \multirow{2}{*}{e$^-$}& 10 GeV & 24531-24576 & 38,028,438\\& 15 GeV & 24507-24527 & 7,701,325\\& 20 GeV & 24479-24504 & 10,498,554\\& 30 GeV & 24454-24475 & 3,382,943\\& 40 GeV & 24420-24448 & 2,665,843\\& 50 GeV & 24404-24419 & 5,933,995\\
    \midrule
    \multirow{2}{*}{$\pi^-$}& 10 GeV & 24266-24272, 24300-24317, 24381-24397 & 24,311,420\\& 20 GeV & 24398-24400 & N/A\footnotemark\\& 30 GeV & 24259-24299, 24319-24380 & 10,120,753\\& 50 GeV & 24212-24254, 24325-24357, 24580-24612 & 10,704,661\\& 70 GeV & 24219-24242, 24365-24374 & 8,885,407\\& 90 GeV & 24233-24287, 24331-24364 & 7,955,604\\
    \bottomrule
  \end{tabular}
\end{table}
\footnotetext{Not analyzed due to limited dataset.}

\begin{table}[htb!]
  \centering
  \caption{List of the different SiPMs used in the CALICE AHCAL in July 2015.}
  \label{table:sipm_list}
  \resizebox{\textwidth}{!}{%
  \begin{tabular}{@{}cccccccc@{}}
    \toprule
    Layer & Producer & Model & Area (mm$^2$) & Pitch ($\mu$m) & WLS Fibre & Read-out type & $N_{px}$ [$10^3$]\\
    \midrule
    1 & Hamamatsu & S12571\_010P & $1\times1$ & 10 & no & Bottom & 10\\
    2 & Hamamatsu & S10362-11-025O & $1\times1$ & 25 & no & Side & 1.6\\
    3 & Hamamatsu & S12571-025P & $1\times1$ & 25 & no & SMD & 1.6\\
    4-5 & Ketek & N/A & $2.25\times2.25$ & 18 & no & Side & 12\\
    6-10 & CPTA & CPTA & $1.28\times1.28$ & 40 & yes & Side & 0.8\\
    11-12 & Ketek (UHH) & PM1125NS-SB0 & $1.2\times1.2$ & 25 & no & Side & 2.3\\
    13-14 & SenSL & MicroFB-10020-SMT & $1\times1$ & 20 & no & Side & 1.3\\
    \bottomrule
  \end{tabular}
  }
\end{table}

\begin{table}[htb!]
  \centering
  \caption{List of AHCAL channels used as time reference for this analysis. In this analysis, the time reference signals are defined as T$_{11}$, T$_{12}$, T$_{13}$ and T$_{14}$ representing the reference channels on Modules 11, 12, 13 and 14 respectively. In this analysis, T$_{12}$, T$_{13}$ and T$_{14}$ only are used.}
  \label{table:trigger_ref}
  \begin{tabular}{@{} ccccc @{}}
    \toprule
    Layer \# & Chip Number & Channel & Comments & Name \\
    \midrule
    11 & 169 & 29 & noisy & T$_{11}$ \\
    11 & 177 & 23 & broken & - \\
    12 & 185 & 29 & - & T$_{12}$ \\
    13 & 201 & 29 & -  & T$_{13}$ \\
    13 & 211 & 6 & broken & - \\
    14 & 217 & 23 & - & T$_{14}$ \\
    \bottomrule
  \end{tabular}
\end{table}

\begin{table}[htb!]
  \centering
  \caption{Selection cuts for the muon run.}
  \label{table:muon_sel}
  \begin{tabular}{@{}lll@{}}
    \toprule
    \multicolumn{1}{l}{\textbf{Name}} & \textbf{Beam Energy} & \textbf{Cut}\\
    \midrule
    \multirow{2}{*}{Preselection}& All & 0 mm < $cog_{z}$ < 800 mm\\& All & 0 < $n_{hits}$ < 20 \\
    \midrule
    \multirow{2}{*}{Track Selection (Modules 1 to 10)}& All & $n_{hits}$ in AHCAL tower > 7 \\& All & $n_{hits}$ in a layer < 3 \\
    \midrule
    \multirow{2}{*}{Track Selection (Modules 11 to 14) outside of inner 12x12 area}& All & $n_{hits}$ in AHCAL tower > 2 \\& All & $n_{hits}$ in a layer < 3 \\
    \bottomrule
  \end{tabular}
\end{table}

\begin{table}[htb!]
  \centering
  \caption{Selection cuts for each electron run.}
  \label{table:electron_sel}
  \begin{tabular}{@{}lll@{}}
    \toprule
    \multicolumn{1}{l}{\textbf{Name}} & \textbf{Beam Energy} & \textbf{Cut}\\
    \midrule
    \multirow{2}{*}{Event Quality}& All & Cherenkov ON\\& All & Energy in the first 3 layers of AHCAL ($E_3 + E_4 + E_5$) > 10 MIP \\
    \midrule
    \multirow{9}{*}{Electron Selection}& 10 GeV & 25 < $n_{hits}$ < 75 \\& 15 GeV & 30 < $n_{hits}$ < 90 \\& 20 GeV & 40 < $n_{hits}$ < 100 \\& 30 GeV & 50 < $n_{hits}$ < 110 \\& 40 GeV & 60 < $n_{hits}$ < 120 \\& 50 GeV & 70 < $n_{hits}$ < 140 \\& All & $cog_{z}$ < 250 mm\\& All & -90 mm < $cog_{x, y}$ < 90 mm \\& All & Energy in last two layers ($E_{13} + E_{14}$) < 1\% $\Sigma E$ \\
    \bottomrule
  \end{tabular}
\end{table}

\begin{table}[htb!]
  \centering
  \caption{Selection cuts for the pions run.}
  \label{table:pion_sel}
  \begin{tabular}{@{}lll@{}}
    \toprule
    \multicolumn{1}{l}{\textbf{Name}} & \textbf{Beam Energy} & \textbf{Cut}\\
    \midrule
    \multirow{1}{*}{Event Quality}& All & Cherenkov OFF\\
    \midrule
    \multirow{3}{*}{Pion Selection}& All & $n_{hits}$ > 20 \\& All & $n_{hits}$ in the first 2 AHCAL layers ($N_3 + N_4$) < 5 \\& All & Energy in last two layers ($E_{13} + E_{14}$) > 1\% $\Sigma E$ \\
    \midrule
    \multirow{2}{*}{Multi Particle Rejection}& All & $n_{hits}$ in time window > 5 \\& All & $n_{Cluster}$ > 0 \\
    \bottomrule
  \end{tabular}
\end{table}

\end{document}
